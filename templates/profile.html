<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clyst - Profile</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/styles.css" />
    <link rel="stylesheet" href="../static/css/profile.css" />
  </head>
  <body>
    <!-- ===== NAVBAR ===== -->
    <nav id="topNav">
      <div class="nav">
        <div class="nav-left">
          <div class="hamburger" onclick="toggleMenu(event)">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M3 4H21V6H3V4ZM3 11H21V13H3V11ZM3 18H21V20H3V18Z"></path>
            </svg>
          </div>
          <a
            href="{{ url_for('home') }}"
            style="text-decoration: none; color: inherit"
            >Clyst</a
          >
        </div>

        <div class="nav-center" id="navLinks">
          <a href="{{ url_for('home') }}">Community Feed</a>
          <a href="{{ url_for('products_page') }}">Marketplace</a>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('logout') }}">Logout</a>
          {% else %}
          <a href="{{ url_for('login') }}">Login</a>
          <a href="{{ url_for('register') }}">Register</a>
          {% endif %}
        </div>

        <div id="google_translate_element" class="translate-element"></div>
      </div>

      <div class="mobile-menu" id="mobileMenu">
        <a href="{{ url_for('home') }}">Community Feed</a>
        <a href="{{ url_for('products_page') }}">Marketplace</a>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('login') }}">Login</a>
        <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
      </div>
    </nav>

    <div class="container">
      <!-- Main Content -->
      <div class="main-content">
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="profile">
            <div class="profile-details">
              <div class="profile-avatar">
                {% if profile_user %} {{ profile_user.name[0].upper() }} {% else
                %} {{ current_user.name[0].upper() }} {% endif %}
              </div>
              <h1 class="profile-name">
                {% if profile_user %} {{ profile_user.name }} {% else %} {{
                current_user.name }} {% endif %}
              </h1>

              <!-- Verification status or prompt -->
              {% if profile_user and profile_user.is_verified or (not
              profile_user and current_user.is_verified) %}
              <div class="profile-verify verified">
                <span
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M4 2H20C20.5523 2 21 2.44772 21 3V22.2763C21 22.5525 20.7761 22.7764 20.5 22.7764C20.4298 22.7764 20.3604 22.7615 20.2963 22.7329L12 19.0313L3.70373 22.7329C3.45155 22.8455 3.15591 22.7322 3.04339 22.4801C3.01478 22.4159 3 22.3465 3 22.2763V3C3 2.44772 3.44772 2 4 2ZM12 13.5L14.9389 15.0451L14.3776 11.7725L16.7553 9.45492L13.4695 8.97746L12 6L10.5305 8.97746L7.24472 9.45492L9.62236 11.7725L9.06107 15.0451L12 13.5Z"
                    ></path>
                  </svg>
                  Verified Artisan
                </span>
              </div>
              {% elif current_user.is_authenticated and (not profile_user or
              current_user.id == profile_user.id) %}
              <div class="btn promote-btn profile-verify">
                <span
                  ><a href="{{ url_for('verify_otp') }}"
                    >Become Verified Artisan</a
                  ></span
                >
              </div>
              {% endif %}

              <!-- Artisan Rating -->
              {% if artisan_rating and artisan_rating.total_reviews > 0 %}
              <div class="artisan-rating">
                <div class="rating-stars">
                  {% for i in range(1, 6) %} {% if i <=
                  artisan_rating.avg_rating|round(0, 'floor') %}
                  <svg
                    class="star-icon icon-20 star--filled"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                    />
                  </svg>
                  {% else %}
                  <svg
                    class="star-icon icon-20 star--empty"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                    />
                  </svg>
                  {% endif %} {% endfor %}
                </div>
                <span class="rating-text"
                  >{{ artisan_rating.avg_rating }}</span
                >
              </div>
              {% endif %}

              <div class="profile-bio">
                <button class="btn contact-btn" onclick="openContactModal()">Contact Info</button>

              </div>
            </div>

            <div class="profile-info">
              <div class="info-item">
                <div class="info-label">Followers</div>
                <div class="info-value" id="followers-count">
                  {{ followers_count }}
                </div>
              </div>
              <div class="info-item">
                <div class="info-label">Following</div>
                <div class="info-value">{{ following_count }}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Joined on</div>
                <div class="info-value">
                  {% if profile_user %} {{ profile_user.created_at }} {% else %}
                  {{ current_user.created_at }} {% endif %}
                </div>
              </div>
            </div>
          </div>
          <!-- Portfolio Narrative Section -->
          {% if portfolio_narrative %}
          <div class="portfolio-narrative">
            <div class="narrative-header">
              <h3>
                About {{ profile_user.name if profile_user else
                current_user.name }}
                <button
                  id="speakNarrative"
                  class="say-aloud-btn"
                  title="Listen to Artist Story"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    fill="#000000"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M168,32V224a8,8,0,0,1-12.91,6.31L85.25,176H40a16,16,0,0,1-16-16V96A16,16,0,0,1,40,80H85.25l69.84-54.31A8,8,0,0,1,168,32Zm32,64a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V104A8,8,0,0,0,200,96Zm32-16a8,8,0,0,0-8,8v80a8,8,0,0,0,16,0V88A8,8,0,0,0,232,80Z"
                    ></path>
                  </svg>
                </button>
              </h3>
            </div>
            <p id="narrativeText">{{ portfolio_narrative }}</p>

            <div class="narrative-meta">
              <div class="narrative-stats">
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"
                    ></path>
                  </svg>
                  <span>{{ posts|length }} Posts</span>
                </div>
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M12 1L21.5 6.5V17.5L12 23L2.5 17.5V6.5L12 1ZM4.5 7.65311V7.65788L12 12V20.689L19.5 16.3469V7.65311L12 3.311L4.5 7.65311ZM19.6673 16.3333 18.0007 13.2083 16.334 16.3333 13.209 17.9999 16.334 19.6666 18.0007 22.7916 19.6673 19.6666 22.7923 17.9999 19.6673 16.3333Z"
                    ></path>
                  </svg>
                  <span>{{ products|length }} Products</span>
                </div>
                <div class="narrative-stat">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="100%"
                    height="100%"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill="currentColor"
                      d="M5 2h2v3H5zm4 0h2v3H9zm4 0h2v3h-2zm6 7h-2V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3h2c1.103 0 2-.897 2-2v-5c0-1.103-.897-2-2-2zm-2 7v-5h2l.002 5H17z"
                    ></path>
                  </svg>
                  <span
                    >{{ (posts|length + products|length) }} Total Works</span
                  >
                </div>
              </div>
              <div class="narrative-stat">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M17.0007 1.20825 18.3195 3.68108 20.7923 4.99992 18.3195 6.31876 17.0007 8.79159 15.6818 6.31876 13.209 4.99992 15.6818 3.68108 17.0007 1.20825ZM8.00065 4.33325 10.6673 9.33325 15.6673 11.9999 10.6673 14.6666 8.00065 19.6666 5.33398 14.6666.333984 11.9999 5.33398 9.33325 8.00065 4.33325ZM19.6673 16.3333 18.0007 13.2083 16.334 16.3333 13.209 17.9999 16.334 19.6666 18.0007 22.7916 19.6673 19.6666 22.7923 17.9999 19.6673 16.3333Z"
                  ></path>
                </svg>
                <span>AI-Generated Narrative</span>
              </div>
            </div>
          </div>
          {% endif %}

          <div class="form-actions">
            {% if current_user.is_authenticated and current_user.id ==
            profile_user.id %}
            <a href="{{ url_for('add_posts') }}" class="btn btn-secondary">
              Add New Post
            </a>
            <a href="{{ url_for('add_products') }}" class="btn btn-secondary">
              Add New Product
            </a>
            {% endif %}
          </div>

          <!-- Toggle Button for Posts/Products -->
          <div class="content-toggle-wrapper">
            <button id="content-toggle-btn" onclick="toggleProfileContent()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9997 13.1714L16.9495 8.22168L18.3637 9.63589L11.9997 15.9999L5.63574 9.63589L7.04996 8.22168L11.9997 13.1714Z"></path></svg>
            </button>
          </div>

          <!-- Content Tabs -->
          <div class="content-tabs" id="profile-content-tabs" style="display: none;">
            <div class="tab-nav">
              <button class="tab-button active" onclick="showTab('posts')">
                {{ posts|length }} Posts
              </button>
              <button class="tab-button" onclick="showTab('products')">
                {{ products|length }} Products
              </button>
            </div>
            <div class="tab-content">
              <!-- Posts Tab -->
              <div id="posts-tab" class="tab-panel">
                {% if posts %}
                <div class="posts-grid">
                  {% for post in posts %}
                  <a href="{{ url_for('home', _anchor='post-' ~ post.post_id) }}" class="post-item-link">
                  <div class="post-item">
                    {% if current_user.is_authenticated and current_user.id == post.artist_id %}
                    <div class="post-actions">
                      <button
                        class="action-btn edit-btn"
                        onclick="openEditPostModal({{ post.post_id|tojson }}, {{ post.post_title|tojson }}, {{ post.description|tojson }}, {{ post.media_url|tojson }}, {{ post.is_promoted|tojson }}); event.preventDefault();"
                        title="Edit Post"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          width="24"
                          height="24"
                          fill="currentColor"
                        >
                          <path
                            d="M15.7279 9.57627L14.3137 8.16206L5 17.4758V18.89H6.41421L15.7279 9.57627ZM17.1421 8.16206L18.5563 6.74785L17.1421 5.33363L15.7279 6.74785L17.1421 8.16206ZM7.24264 20.89H3V16.6474L16.435 3.21233C16.8256 2.82181 17.4587 2.82181 17.8492 3.21233L20.6777 6.04075C21.0682 6.43128 21.0682 7.06444 20.6777 7.45497L7.24264 20.89Z"
                          ></path>
                        </svg>
                      </button>
                      <button
                        class="action-btn delete-btn"
                        onclick="if(confirm('Delete this post?')) window.location.href='{{ url_for('delete_posts', post_id=post.post_id) }}'; event.preventDefault();"
                        title="Delete Post"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          width="24"
                          height="24"
                          fill="currentColor"
                        >
                          <path
                            d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM9 11V17H11V11H9ZM13 11V17H15V11H13ZM9 4V6H15V4H9Z"
                          ></path>
                        </svg>
                      </button>
                    </div>
                    {% endif %}
                    <button
                      class="share-btn"
                      data-share-url="{{ url_for('home') }}?q={{ post.post_title }}+{{ post.artist.name }}"
                      data-share-title="{{ post.post_title }}"
                      data-share-text="By {{ post.artist.name }}"
                      onclick="openShareFromEl(this); event.preventDefault();"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        width="24"
                        height="24"
                        fill="currentColor"
                      >
                        <path
                          d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z"
                        ></path>
                      </svg>
                    </button>
                    {% if post.media_url %}
                    <img
                      src="{{ post.media_url }}"
                      alt="{{ post.post_title }}"
                      class="item-image"
                    />
                    {% else %}
                    <div class="item-image placeholder">
                      <i class="fas fa-image"></i>
                    </div>
                    {% endif %}
                    <div class="item-content">
                      <div class="item-actions">
                        <span class="info-value">{{ post.created_at }}</span>
                      </div>
                      <h3 class="item-title">{{ post.post_title }}</h3>
                      <p class="item-description">
                        {{ post.description[:100] }}{% if post.description|length > 100 %}...{% endif %}
                      </p>
                    </div>
                  </div>
                  </a>
                  {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"
                    ></path>
                  </svg>
                  {% if current_user.is_authenticated and current_user.id == profile_user.id %}
                  <h3>ADD POSTS TO START</h3>
                  <p>Start sharing your artwork with the community</p>
                  <a href="{{ url_for('add_posts') }}" class="btn btn-secondary">
                    Add New Post
                  </a>
                  {% else %}
                  <h3>NO POSTS AVAILABLE</h3>
                  <p>{{ profile_user.name }} has not shared any posts yet.</p>
                  {% endif %}
                </div>
                {% endif %}
              </div>

              <!-- Products Tab -->
              <div id="products-tab" class="tab-panel" style="display: none">
                {% if products %}
                <div class="products-grid">
                  {% for product in products %}
                  <a href="{{ url_for('product_buy', product_id=product.product_id) }}" class="product-item-link">
                  <div class="product-item">
                    {% if product.img_url %}
                    <img
                      src="{{ product.img_url }}"
                      alt="{{ product.title }}"
                      class="item-image"
                    />
                    {% else %}
                    <div class="item-image placeholder">
                      <i class="fas fa-image"></i>
                    </div>
                    {% endif %}
                    <div class="item-content">
                      {% if current_user.id == product.artist_id %}
                      <form
                        method="post"
                        action="{{ url_for('promote_product', product_id=product.product_id) }}"
                        class="promote-form"
                        onclick="event.preventDefault();"
                      >
                        <button
                          type="submit"
                          class="btn promote-btn"
                          title="Promote Product"
                        >
                          Promote Product
                        </button>
                      </form>
                      {% endif %}
                      <div class="item-actions">
                        <span class="info-value">{{ product.created_at }}</span>
                      </div>
                      <h3 class="item-title">{{ product.title }}</h3>
                      <p class="item-description">
                        {{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
                      </p>
                      <button
                        class="share-btn"
                        data-share-url="{{ url_for('product_buy', product_id=product.product_id) }}"
                        data-share-title="{{ product.title }}"
                        data-share-text="By {{ product.artist.name }}"
                        onclick="openShareFromEl(this); event.preventDefault();"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          width="24"
                          height="24"
                          fill="currentColor"
                        >
                          <path
                            d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z"
                          ></path>
                        </svg>
                      </button>
                      <span class="item-price">Rs.{{ product.price }}</span>
                    </div>
                  </div>
                  </a>
                  {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"
                    ></path>
                  </svg>
                  {% if current_user.is_authenticated and current_user.id == profile_user.id %}
                  <h3>ADD PRODUCTS TO START</h3>
                  <p>Start selling your artwork in the marketplace</p>
                  <a href="{{ url_for('add_products') }}" class="btn btn-secondary">
                    Add New Product
                  </a>
                  {% else %}
                  <h3>NO PRODUCTS AVAILABLE</h3>
                  <p>{{ profile_user.name }} has not listed any products yet.</p>
                  {% endif %}
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Floating Inbox Button -->
    {% if current_user.is_authenticated and (not profile_user or current_user.id == profile_user.id) %}
    <button class="inbox-icon-btn" onclick="toggleInboxModal()" title="Inbox" aria-label="Open Inbox">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M3 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3ZM20 7.23792L12.0718 14.338L4 7.21594V19H20V7.23792ZM4.51146 5L12.0619 11.662L19.501 5H4.51146Z"></path>
      </svg>
      {% if unread_count and unread_count > 0 %}
        <span class="inbox-badge">{{ unread_count }}</span>
      {% endif %}
    </button>

    <!-- Inbox Modal -->
    <div class="inbox-modal" id="inboxModal">
      <div class="inbox-modal-header">
        <h3>Inbox</h3>
        <button class="inbox-modal-close" onclick="toggleInboxModal()" aria-label="Close Inbox">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 10.586L16.95 5.63599L18.364 7.04999L13.414 12L18.364 16.95L16.95 18.364L12 13.414L7.04999 18.364L5.63599 16.95L10.586 12L5.63599 7.04999L7.04999 5.63599L12 10.586Z"></path>
          </svg>
        </button>
      </div>
      <div class="inbox-modal-body">
        {% if conversations %}
          <ul class="inbox-list">
            {% for convo in conversations %}
            <li class="inbox-item">
              <a href="{{ url_for('view_conversation', conversation_id=convo.id) }}">
                <div>
                  <strong>{{ convo.product.title }}</strong>
                  {% if convo.unread_count > 0 %}
                    <span class="badge">{{ convo.unread_count }} new</span>
                  {% endif %}
                </div>
                <div style="font-size: 13px; color: var(--muted);">
                  with {{ convo.other_user.name }}
                </div>
                <span class="inbox-date">{{ convo.last_message_at }}</span>
              </a>
            </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="empty-state" style="padding: 40px 20px; text-align: center;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 48px; height: 48px; margin: 0 auto 12px; opacity: 0.3;">
              <path d="M21 4H3C2.44772 4 2 4.44772 2 5V19C2 19.5523 2.44772 20 3 20H21C21.5523 20 22 19.5523 22 19V5C22 4.44772 21.5523 4 21 4ZM20 18H4V6H20V18ZM6 8H18V10H6V8ZM6 12H18V14H6V12ZM6 16H14V18H6V16Z"></path>
            </svg>
            <h3 style="margin: 0 0 8px; font-size: 16px;">No conversations yet</h3>
            <p style="margin: 0; font-size: 14px; color: var(--muted);">Your messages with buyers and sellers will appear here.</p>
          </div>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Contact Info Modal -->
    <div class="modal" id="contactModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Contact Information</h2>
          <button type="button" class="close-btn" onclick="closeContactModal()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"></path></svg>
          </button>
        </div>
        <div class="modal-body">
          {% if profile_user %}
            <div class="contact-item">
              <p><strong>Email:</strong> <span id="email-text">{{ profile_user.email }}</span></p>
              <button class="copy-btn" onclick="copyToClipboard('{{ profile_user.email }}', this)" title="Copy Email">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
              </button>
            </div>
            <div class="contact-item">
              <p><strong>Phone:</strong> <span id="phone-text">{{ profile_user.phone or 'Not provided' }}</span></p>
              {% if profile_user.phone %}
              <button class="copy-btn" onclick="copyToClipboard('{{ profile_user.phone }}', this)" title="Copy Phone">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
              </button>
              {% endif %}
            </div>
            <div class="contact-item">
              <p><strong>Location:</strong> <span id="location-text">{{ profile_user.location or 'Not provided' }}</span></p>
            </div>
          {% else %}
            <div class="contact-item">
              <p><strong>Email:</strong> <span id="email-text">{{ current_user.email }}</span></p>
              <button class="copy-btn" onclick="copyToClipboard('{{ current_user.email }}', this)" title="Copy Email">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
              </button>
            </div>
            <div class="contact-item">
              <p><strong>Phone:</strong> <span id="phone-text">{{ current_user.phone or 'Not provided' }}</span></p>
              {% if current_user.phone %}
              <button class="copy-btn" onclick="copyToClipboard('{{ current_user.phone }}', this)" title="Copy Phone">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
              </button>
              {% endif %}
            </div>
            <div class="contact-item">
              <p><strong>Location:</strong> <span id="location-text">{{ current_user.location or 'Not provided' }}</span></p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <script>
          function toggleMenu(e) {
        e?.stopPropagation?.();
        const menu = document.getElementById("mobileMenu");
        const now = menu.style.display === "flex" ? "none" : "flex";
        menu.style.display = now;
            if (now === "flex")
              document.getElementById("searchBelow").classList.remove("open");
      }

          function toggleSearch() {
        const bar = document.getElementById("searchBelow");
        bar.classList.toggle("open");
        const menu = document.getElementById("mobileMenu");
            if (menu.style.display === "flex") menu.style.display = "none";
            if (bar.classList.contains("open")) {
              requestAnimationFrame(() =>
                document.getElementById("globalSearchInput").focus()
              );
        }
      }

      // Toggle inbox modal
      function toggleInboxModal() {
        const modal = document.getElementById("inboxModal");
        if (modal) {
          modal.classList.toggle("show");
        }
      }

      // Close inbox modal when clicking outside
      document.addEventListener('click', function(event) {
        const modal = document.getElementById("inboxModal");
        const btn = document.querySelector(".inbox-icon-btn");
        if (modal && modal.classList.contains("show") && 
            !modal.contains(event.target) && 
            !btn.contains(event.target)) {
          modal.classList.remove("show");
        }
      });

      // Highlight active nav link
          document.addEventListener("DOMContentLoaded", function () {
            const path = window.location.pathname.split("/").pop();
            document
              .querySelectorAll(".nav-center a, .mobile-menu a")
              .forEach((link) => {
                if (link.getAttribute("href") === path) {
                  link.classList.add("active");
          } else {
                  link.classList.remove("active");
          }
        });
      });

          function showTab(tabName) {
            // Hide all tab panels
            const tabPanels = document.querySelectorAll(".tab-panel");
            tabPanels.forEach((panel) => (panel.style.display = "none"));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll(".tab-button");
            tabButtons.forEach((button) => button.classList.remove("active"));

            // Show selected tab panel
            document.getElementById(tabName + "-tab").style.display = "block";

            // Add active class to clicked button
            event.target.classList.add("active");
          }

          function sayAloud(text, button) {
            // If speech is currently happening, stop it.
            if (window.speechSynthesis.speaking) {
              window.speechSynthesis.cancel();
              // The 'onend' event will handle resetting the button style.
              return;
            }

            const message = new SpeechSynthesisUtterance();
            message.text = `The title of the artwork is ${text.title}. It is created by ${text.artist}. The price of the artwork is Rs.${text.price}. The description says it is ${text.description}.`;
            
            const originalIcon = button.innerHTML;

            // When speech starts, change icon to pause and add 'playing' class.
            message.onstart = function() {
              button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 17H9V7H5V17ZM15 17H19V7H15V17Z"></path></svg>';
              button.classList.add('playing');
            };

            // Function to reset the button to its original state.
            const resetButtonStyle = () => {
              button.innerHTML = originalIcon;
              button.classList.remove('playing');
            };

            // onend is called for both natural completion and cancellation.
            message.onend = resetButtonStyle;
            
            // Also reset on error.
            message.onerror = function(event) {
              console.error('Speech synthesis error:', event.error);
              resetButtonStyle();
            };

            window.speechSynthesis.speak(message);
          }

          // Helper function to read data from button attributes and pass the button itself.
          function sayAloudFromData(button) {
            const text = {
              title: button.dataset.title || '',
              artist: button.dataset.artist || '',
              price: button.dataset.price || '',
              description: button.dataset.description || 'No description available'
            };
            sayAloud(text, button);
          }

          async function copyToClipboard(textToCopy, button) {
            try {
              await navigator.clipboard.writeText(textToCopy);
              
              const originalIcon = button.innerHTML;
              const originalTitle = button.title;

              button.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"></path></svg>';
              button.title = "Copied!";
              button.disabled = true;

              setTimeout(() => {
                button.innerHTML = originalIcon;
                button.title = originalTitle;
                button.disabled = false;
              }, 2000);

            } catch (err) {
              alert("Failed to copy text: " + err);
            }
          }

       // Text-to-Speech functionality
       let speechSynthesis = window.speechSynthesis;
       let currentUtterance = null;
       let isPlaying = false;

       // Function to detect current language from Google Translate
       function getCurrentLanguage() {
         // Method 1: Check if page has been translated by Google Translate
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Try to get language from Google Translate's iframe
           const translateFrame = document.querySelector('iframe[src*="translate.google"]');
           if (translateFrame) {
             try {
               const frameDoc = translateFrame.contentDocument || translateFrame.contentWindow.document;
               const langSelect = frameDoc.querySelector('select');
               if (langSelect && langSelect.value) {
                 return langSelect.value;
               }
             } catch (e) {
               // Cross-origin access blocked
             }
           }

           // Try to detect from URL parameters
           const urlParams = new URLSearchParams(window.location.search);
           const lang = urlParams.get('hl');
           if (lang) return lang;

           // Check for Google Translate's language indicator
           const langIndicator = document.querySelector('[data-google-lang]');
           if (langIndicator) {
             return langIndicator.getAttribute('data-google-lang');
           }

           // Try to detect from Google Translate's global state
           if (window.google && window.google.translate && window.google.translate.TranslateElement) {
             const translateElement = document.querySelector('.goog-te-combo');
             if (translateElement && translateElement.value) {
               return translateElement.value;
             }
           }
         }

         // Method 2: Check for Google Translate's language selector
         const langSelect = document.querySelector('.goog-te-combo');
         if (langSelect && langSelect.value && langSelect.value !== 'en') {
           return langSelect.value;
         }

         // Method 3: Check for Google Translate's banner frame
         const googleBanner = document.querySelector('.goog-te-banner-frame');
         if (googleBanner) {
           const bannerSelect = googleBanner.querySelector('select');
           if (bannerSelect && bannerSelect.value) {
             return bannerSelect.value;
           }
         }

         // Default to English if no translation detected
         return 'en';
       }

       // Function to detect language from Google Translate's actual implementation
       function detectGoogleTranslateLanguage() {
         // Check if Google Translate is active
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Try to get language from Google Translate's iframe
           const translateFrame = document.querySelector('iframe[src*="translate.google"]');
           if (translateFrame) {
             try {
               const frameDoc = translateFrame.contentDocument || translateFrame.contentWindow.document;
               const langSelect = frameDoc.querySelector('select');
               if (langSelect && langSelect.value) {
                 return langSelect.value;
               }
             } catch (e) {
               // Cross-origin access blocked
             }
           }

           // Try to detect from URL parameters
           const urlParams = new URLSearchParams(window.location.search);
           const lang = urlParams.get('hl');
           if (lang) return lang;

           // Check for Google Translate's language indicator
           const langIndicator = document.querySelector('[data-google-lang]');
           if (langIndicator) {
             return langIndicator.getAttribute('data-google-lang');
           }

           // Try to detect from Google Translate's global state
           if (window.google && window.google.translate && window.google.translate.TranslateElement) {
             const translateElement = document.querySelector('.goog-te-combo');
             if (translateElement && translateElement.value) {
               return translateElement.value;
             }
           }
         }

         // Check for Google Translate's language selector
         const langSelect = document.querySelector('.goog-te-combo');
         if (langSelect && langSelect.value && langSelect.value !== 'en') {
           return langSelect.value;
         }

         // Check for Google Translate's banner frame
         const googleBanner = document.querySelector('.goog-te-banner-frame');
         if (googleBanner) {
           const bannerSelect = googleBanner.querySelector('select');
           if (bannerSelect && bannerSelect.value) {
             return bannerSelect.value;
           }
         }

         // Default to English if no translation detected
         return 'en';
       }

       // Function to get the actual translated text
       function getTranslatedText() {
         const narrativeElement = document.getElementById('narrativeText');
         if (!narrativeElement) return '';

         // Check if the page has been translated
         const body = document.body;
         if (body.classList.contains('translated-ltr') || body.classList.contains('translated-rtl')) {
           // Return the translated text that's currently displayed
           return narrativeElement.textContent || narrativeElement.innerText;
         }

         // Return original text if not translated
         return narrativeElement.textContent || narrativeElement.innerText;
       }

           function speakNarrative() {
             const narrativeText = document.getElementById('narrativeText');
             const speakBtn = document.getElementById('speakNarrative');

             if (!narrativeText) return;

             // Stop any current speech
             if (isPlaying) {
               stopSpeech();
               return;
             }

         // Get the actual translated text
         const translatedText = getTranslatedText();

         // Create enhanced narrative for speech
         const artistName = "{{ profile_user.name if profile_user else current_user.name }}";
         const postsCount = {{ posts|length }};
         const productsCount = {{ products|length }};
         const totalWorks = postsCount + productsCount;
         const location = "{{ profile_user.location if profile_user else current_user.location }}";

         const enhancedNarrative = `${translatedText} This collection features ${totalWorks} unique works, including ${postsCount} community posts and ${productsCount} marketplace products, each telling a part of ${artistName}'s creative story.`;

             // Create utterance
             currentUtterance = new SpeechSynthesisUtterance(enhancedNarrative);

             // Configure voice settings
             currentUtterance.rate = 0.9;
             currentUtterance.pitch = 1.0;
             currentUtterance.volume = 0.8;

         // Detect current language from Google Translate
         const currentLang = detectGoogleTranslateLanguage();
         console.log('Detected language:', currentLang);

         // Try to use a pleasant voice in the current language
         const voices = speechSynthesis.getVoices();
         console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));

         const preferredVoice = voices.find(function(voice) {
           return voice.lang.startsWith(currentLang) &&
             (voice.name.includes('Google') || voice.name.includes('Microsoft') || voice.name.includes('Samantha') || voice.name.includes('Natural'));
         });

         // Fallback to any voice in the current language
         const fallbackVoice = voices.find(function(voice) {
           return voice.lang.startsWith(currentLang);
         });

         if (preferredVoice) {
           currentUtterance.voice = preferredVoice;
           console.log('Using preferred voice:', preferredVoice.name);
         } else if (fallbackVoice) {
           currentUtterance.voice = fallbackVoice;
           console.log('Using fallback voice:', fallbackVoice.name);
         } else {
           console.log('No voice found for language:', currentLang);
         }

         // Set language for the utterance
         currentUtterance.lang = currentLang;

             // Event handlers
             currentUtterance.onstart = function() {
               isPlaying = true;
               speakBtn.classList.add('playing');
               speakBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.0007 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"></path></svg>';
             };

             currentUtterance.onend = function() {
               stopSpeech();
             };

         currentUtterance.onerror = function(event) {
           console.error('Speech synthesis error:', event.error);
           stopSpeech();
         };

             // Start speaking
             speechSynthesis.speak(currentUtterance);
           }

           function stopSpeech() {
             if (currentUtterance) {
               speechSynthesis.cancel();
             }

             isPlaying = false;
             const speakBtn = document.getElementById('speakNarrative');

             if (speakBtn) {
               speakBtn.classList.remove('playing');
               speakBtn.innerHTML = `
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    fill="#000000"
                    viewBox="0 0 256 256"
                  >
                    <path
                      d="M168,32V224a8,8,0,0,1-12.91,6.31L85.25,176H40a16,16,0,0,1-16-16V96A16,16,0,0,1,40,80H85.25l69.84-54.31A8,8,0,0,1,168,32Zm32,64a8,8,0,0,0-8,8v48a8,8,0,0,0,16,0V104A8,8,0,0,0,200,96Zm32-16a8,8,0,0,0-8,8v80a8,8,0,0,0,16,0V88A8,8,0,0,0,232,80Z"
                    ></path>
                  </svg>
               `;
             }
           }

       // Event listeners
       document.addEventListener('DOMContentLoaded', function() {
         const speakBtn = document.getElementById('speakNarrative');

         if (speakBtn) {
           speakBtn.addEventListener('click', speakNarrative);
         }

         // Listen for Google Translate events
         const observer = new MutationObserver(function(mutations) {
           mutations.forEach(function(mutation) {
             if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
               const target = mutation.target;
               if (target === document.body &&
                   (target.classList.contains('translated-ltr') || target.classList.contains('translated-rtl'))) {
                 console.log('Page translated, language detection updated');
               }
             }
           });
         });

         // Start observing
         observer.observe(document.body, {
           attributes: true,
           attributeFilter: ['class']
         });

         // Also listen for Google Translate's language change events
         if (window.google && window.google.translate && window.google.translate.TranslateElement && window.google.translate.TranslateElement.prototype) {
           window.google.translate.TranslateElement.prototype.onLanguageChange = function() {
             console.log('Google Translate language changed');
           };
         }

         // Override Google Translate's language change function
         if (window.google && window.google.translate && window.google.translate.TranslateElement && window.google.translate.TranslateElement.prototype) {
           const originalOnLanguageChange = window.google.translate.TranslateElement.prototype.onLanguageChange;
           window.google.translate.TranslateElement.prototype.onLanguageChange = function() {
             console.log('Google Translate language changed - intercepted');
             if (originalOnLanguageChange) {
               originalOnLanguageChange.call(this);
             }
           };
         }

         // Add a more direct approach - listen for clicks on Google Translate elements
         document.addEventListener('click', function(event) {
           if (event.target.closest('.goog-te-combo')) {
             setTimeout(function() {
               console.log('Google Translate combo clicked, checking language...');
               const langSelect = document.querySelector('.goog-te-combo');
               if (langSelect && langSelect.value) {
                 console.log('Current Google Translate language:', langSelect.value);
               }
             }, 100);
           }
         });
       });

      function openContactModal() {
        const modal = document.getElementById("contactModal");
        modal.classList.add("open");
        document.body.style.overflow = "hidden";
      }

      function closeContactModal() {
        const modal = document.getElementById("contactModal");
        modal.classList.remove("open");
        document.body.style.overflow = "";
      }

      function toggleProfileContent() {
        const content = document.getElementById("profile-content-tabs");
        const btn = document.getElementById("content-toggle-btn");
        const isHidden = content.style.display === "none";

        if (isHidden) {
          content.style.display = "block";
          btn.classList.add("open");
          setTimeout(() => {
            content.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 100);
        } else {
          content.style.display = "none";
          btn.classList.remove("open");
          document.querySelector('.profile-header').scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>
    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en", // Set your website's default language
            includedLanguages:
              "en,hi,bi,ta,te,mr,gu,kn,ml,pa,ur,es,fr,de,zh,ja,ko", // Optional: Specify languages to include in the dropdown
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE, // Optional: Customize widget layout
          },
          "google_translate_element"
        );
      }
    </script>

    <script>
      // Edit post modal functionality
      function openEditPostModal(
        postId,
        title,
        description,
        mediaUrl,
        isPromoted
      ) {
        // Create modal HTML
        const modal = document.createElement("div");
        modal.className = "modal";
        modal.id = "editPostModal";
        modal.innerHTML = `
          <div class="modal-content">
            <div class="modal-header">
              <h2>Edit Post</h2>
              <button type="button" class="close-btn" onclick="closeEditPostModal()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"></path></svg>
              </button>
            </div>
            <form id="editPostForm" action="/add_posts" method="POST" enctype="multipart/form-data">
              <input type="hidden" name="post_id" value="${postId}">
              <div class="form-group">
                <label for="post_title">Post Title</label>
                <input type="text" id="post_title" name="post_title" value="${title}" required>
              </div>
              <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" required>${description}</textarea>
              </div>
              <div class="form-group">
                <label for="media">Image (leave empty to keep current)</label>
                <input type="file" id="media" name="media" accept="image/*">
                ${
                  mediaUrl
                    ? `<img src="${mediaUrl}" alt="Current image" class="preview-image">`
                    : ""
                }
              </div>
              <div class="modal-footer">
                <button type="button" onclick="closeEditPostModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
              </div>
            </form>
          </div>
        `;

        // Add modal to page
        document.body.appendChild(modal);
        document.body.style.overflow = "hidden";

        // Show modal with animation
        setTimeout(() => modal.classList.add("open"), 10);

        // Setup form submission
        const form = document.getElementById("editPostForm");
        form.onsubmit = async (e) => {
          e.preventDefault();
          const formData = new FormData(form);

          try {
            const response = await fetch("{{ url_for('add_posts') }}", {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              window.location.reload();
            } else {
              throw new Error("Failed to update post");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("Failed to update post. Please try again.");
          }
        };
      }

      function closeEditPostModal() {
        const modal = document.getElementById("editPostModal");
        modal.classList.remove("open");
        setTimeout(() => {
          modal.remove();
          document.body.style.overflow = "";
        }, 300);
      }
    </script>

    <style>
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal.open {
        opacity: 1;
      }

      .modal-content {
        background: var(--card);
        border: 1px solid var(--border);
        padding: 20px;
        border-radius: 24px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        transform: translateY(20px);
        transition: transform 0.3s ease;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .modal.open .modal-content {
        transform: translateY(0);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border);
      }

      .modal-header h2 {
        color: var(--text);
      }

      .close-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        color: var(--muted);
        transition: all 0.2s;
        border-radius: 2px;
      }

      .close-btn:hover {
        color: var(--accent);
        background: var(--bg);
      }

      .close-btn svg {
        width: 24px;
        height: 24px;
        fill: currentColor;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text);
        font-weight: 500;
      }

      .form-group input[type="text"],
      .form-group textarea,
      .form-group input[type="file"] {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 2px;
        background: var(--bg);
        color: var(--text);
        font-family: inherit;
        transition: border-color 0.2s;
      }

      .form-group input[type="text"]:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.1);
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .preview-image {
        max-width: 100%;
        height: auto;
        margin-top: 10px;
        border-radius: 2px;
        border: 1px solid var(--border);
      }

      .modal-footer {
        margin-top: 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 2px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
        border: none;
      }

      .btn-primary:hover {
        background: #ff5252;
      }

      .btn-secondary {
        background: var(--bg);
        color: var(--text);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--card);
      }

      .post-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: background-color 0.2s ease;
      }

      .action-btn:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      .action-btn svg {
        width: 20px;
        height: 20px;
      }

      .edit-btn svg {
        color: #0066cc;
      }

      .delete-btn svg {
        color: #dc3545;
      }
    </style>

    <script>
      // Follow/Unfollow functionality
      function toggleFollow(event, userId) {
        event.preventDefault();

        const followBtn = document.getElementById("follow-btn");
        const isFollowing = followBtn.textContent.trim() === "UNFOLLOW";
        const endpoint = isFollowing
          ? `/unfollow/${userId}`
          : `/follow/${userId}`;

        fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Toggle button text
              followBtn.textContent = isFollowing ? "FOLLOW" : "UNFOLLOW";

              // Update followers count
              const followersCountEl =
                document.getElementById("followers-count");
              if (followersCountEl) {
                followersCountEl.textContent = data.followers_count;
              }
            } else {
              alert(data.message || "An error occurred");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
          });
      }

      // Delete Account Confirmation and Handler
      function confirmDeleteAccount(event) {
        event.preventDefault();
        
        const confirmed = confirm(
          " WARNING: This action is permanent and cannot be undone!\n\n" +
          "Deleting your account will:\n" +
          " Delete all your posts and products\n" +
          " Delete all your comments and reviews\n" +
          " Delete all your orders and cart items\n" +
          " Delete all your messages and conversations\n" +
          " Remove your account from Firebase Authentication\n\n" +
          "Are you absolutely sure you want to delete your account?"
        );
        
        if (!confirmed) {
          return;
        }
        
        // Double confirmation
        const doubleConfirm = confirm(
          "This is your last chance!\n\n" +
          "Type your confirmation: Click OK to permanently delete your account."
        );
        
        if (!doubleConfirm) {
          return;
        }
        
        // Show loading state
        const deleteBtn = event.target;
        const originalText = deleteBtn.textContent;
        deleteBtn.textContent = "DELETING...";
        deleteBtn.style.pointerEvents = "none";
        
        // Prepare request body with optional Firebase id token
        const sendDelete = (idToken) => {
          const body = idToken ? { firebase_token: idToken } : {};
          return fetch("{{ url_for('delete_account') }}", {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            credentials: 'same-origin',
            body: JSON.stringify(body)
          });
        };

        // If Firebase SDK is available and user is signed in, include an ID token
        try {
          if (window.firebase && firebase.apps && firebase.apps.length && firebase.auth().currentUser) {
            firebase.auth().currentUser.getIdToken()
              .then((token) => sendDelete(token))
              .catch(() => sendDelete())
              .then(res => res.json())
              .then(handleDeleteResponse)
              .catch(handleDeleteError);
          } else {
            sendDelete()
              .then(res => res.json())
              .then(handleDeleteResponse)
              .catch(handleDeleteError);
          }
        } catch (e) {
          // Fallback if Firebase isn't initialized
          sendDelete()
            .then(res => res.json())
            .then(handleDeleteResponse)
            .catch(handleDeleteError);
        }

        function handleDeleteResponse(data) {
          if (data.success) {
            alert("Your account has been successfully deleted.");
            window.location.href = data.redirect || "{{ url_for('home') }}";
          } else {
            alert(data.error || "Failed to delete account. Please try again.");
            deleteBtn.textContent = originalText;
            deleteBtn.style.pointerEvents = "auto";
          }
        }

        function handleDeleteError(error) {
          console.error("Error:", error);
          alert("An error occurred while deleting your account. Please try again.");
          deleteBtn.textContent = originalText;
          deleteBtn.style.pointerEvents = "auto";
        }
      }
    </script>

    <!-- Firebase SDK for optional ID token during delete -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script>
      try {
        const firebaseConfig = {
          apiKey: "{{ firebase_config.apiKey }}",
          authDomain: "{{ firebase_config.authDomain }}",
          projectId: "{{ firebase_config.projectId }}",
          storageBucket: "{{ firebase_config.storageBucket }}",
          messagingSenderId: "{{ firebase_config.messagingSenderId }}",
          appId: "{{ firebase_config.appId }}"
        };
        if (window.firebase && (!firebase.apps || !firebase.apps.length)) {
          firebase.initializeApp(firebaseConfig);
        }
      } catch (e) {
        // Non-blocking if Firebase isn't used on this page
      }
    </script>
    
    <button
      id="translateButton"
      onclick="googleTranslateElementInit()"
      class="translate-btn"
    >
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.5 10L22.9 21H20.745L19.544 18H15.454L14.255 21H12.101L16.5 10H18.5ZM10 2V4H16V6L14.0322 6.0006C13.2425 8.36616 11.9988 10.5057 10.4115 12.301C11.1344 12.9457 11.917 13.5176 12.7475 14.0079L11.9969 15.8855C10.9237 15.2781 9.91944 14.5524 8.99961 13.7249C7.21403 15.332 5.10914 16.5553 2.79891 17.2734L2.26257 15.3442C4.2385 14.7203 6.04543 13.6737 7.59042 12.3021C6.46277 11.0281 5.50873 9.57985 4.76742 8.00028L7.00684 8.00037C7.57018 9.03885 8.23979 10.0033 8.99967 10.877C10.2283 9.46508 11.2205 7.81616 11.9095 6.00101L2 6V4H8V2H10ZM17.5 12.8852L16.253 16H18.745L17.5 12.8852Z"></path></svg>
    </button>
    
    <script src="../static/js/app.js"></script>
  </body>
</html>
